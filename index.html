<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Van_Dragon Contribution Tracker Pro - Multiplayer</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0c0c1d;
            --secondary: #1a1a3a;
            --accent: #00ff9d;
            --accent-dark: #00cc7a;
            --accent-light: #66ffc2;
            --text: #e0e0ff;
            --text-secondary: #a0a0c0;
            --card-bg: rgba(10, 10, 25, 0.7);
            --border-color: rgba(0, 255, 157, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background: var(--primary);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(26, 26, 58, 0.3) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(26, 26, 58, 0.3) 0%, transparent 20%),
                linear-gradient(to bottom, var(--primary), #000);
        }

        /* Login Modal */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .login-container {
            background: var(--card-bg);
            border: 2px solid var(--accent);
            border-radius: 16px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 50px rgba(0, 255, 157, 0.3);
            animation: slideIn 0.5s ease;
        }

        .login-ascii {
            font-family: 'Courier New', monospace;
            font-size: 0.4rem;
            color: var(--accent);
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
            line-height: 0.5rem;
            margin-bottom: 2rem;
            white-space: pre;
            text-align: center;
        }

        .login-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            color: var(--accent);
            text-align: center;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(0, 255, 157, 0.6);
        }

        .login-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }

        .login-input {
            width: 100%;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Share Tech Mono', monospace;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.3);
        }

        .login-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            border: none;
            border-radius: 8px;
            color: var(--primary);
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 255, 157, 0.4);
        }

        /* iOS Style Notifications */
        .ios-notification {
            position: fixed;
            top: -200px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            min-width: 320px;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 10001;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .ios-notification.show {
            top: 20px;
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 0.5rem;
        }

        .notification-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }

        .notification-app {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            color: #000;
        }

        .notification-time {
            margin-left: auto;
            font-size: 0.75rem;
            color: #666;
        }

        .notification-title {
            font-weight: 700;
            font-size: 0.9rem;
            color: #000;
            margin-bottom: 0.3rem;
        }

        .notification-message {
            font-size: 0.85rem;
            color: #333;
            line-height: 1.4;
        }

        .dragon-seed {
            position: fixed;
            width: 2px;
            height: 2px;
            background: var(--accent);
            border-radius: 50%;
            opacity: 0;
            animation: float 5s infinite ease-in-out;
            pointer-events: none;
            box-shadow: 0 0 10px var(--accent);
        }

        @keyframes float {
            0%, 100% { opacity: 0; transform: translateY(0) scale(1); }
            50% { opacity: 0.6; transform: translateY(-20px) scale(1.5); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .container {
            max-width: 1400px;
            width: 100%;
            display: none;
        }

        .container.active {
            display: block;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.8s ease;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 2rem;
        }

        .title-ascii {
            font-family: 'Courier New', monospace;
            font-size: 0.5rem;
            color: var(--accent);
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
            line-height: 0.6rem;
            margin-bottom: 1rem;
            white-space: pre;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.8rem;
            color: var(--accent);
            text-shadow: 0 0 20px rgba(0, 255, 157, 0.6);
            margin-bottom: 0.5rem;
            font-weight: 900;
            letter-spacing: 3px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            font-family: 'Share Tech Mono', monospace;
        }

        .user-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 1rem;
            padding: 1rem;
            background: rgba(0, 255, 157, 0.1);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: 700;
        }

        .theme-switch {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .theme-btn {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Share Tech Mono', monospace;
            transition: all 0.3s;
            font-size: 0.85rem;
        }

        .theme-btn:hover {
            background: rgba(0, 255, 157, 0.1);
            transform: translateY(-2px);
            border-color: var(--accent);
        }

        .theme-btn.active {
            background: rgba(0, 255, 157, 0.2);
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(0, 255, 157, 0.3);
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            animation: scan 3s infinite;
        }

        @keyframes scan {
            0%, 100% { left: -100%; }
            50% { left: 100%; }
        }

        .stat:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 8px 30px rgba(0, 255, 157, 0.3);
        }

        .stat-value {
            font-size: 2.2rem;
            color: var(--accent);
            font-weight: 700;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 15px rgba(0, 255, 157, 0.5);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 0.5rem;
        }

        .game-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.8s ease 0.2s backwards;
            box-shadow: 0 4px 20px rgba(0, 255, 157, 0.1);
        }

        .section-header {
            font-family: 'Orbitron', sans-serif;
            color: var(--accent);
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controls {
            display: flex;
            gap: 0.8rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            color: var(--primary);
            border: none;
            padding: 0.7rem 1.2rem;
            border-radius: 6px;
            font-family: 'Share Tech Mono', monospace;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 255, 157, 0.4);
        }

        .btn-secondary {
            background: rgba(0, 255, 157, 0.1);
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        .mode-indicator {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 0.8rem 1.2rem;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 1rem;
        }

        .mode-indicator.draw-active {
            border-color: var(--accent);
            background: rgba(0, 255, 157, 0.1);
        }

        .grid-container {
            overflow-x: auto;
            padding: 1rem;
            margin-top: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .contribution-grid {
            display: inline-grid;
            grid-template-rows: repeat(7, 1fr);
            grid-auto-flow: column;
            gap: 4px;
            min-width: fit-content;
        }

        .contribution-cell {
            width: 14px;
            height: 14px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(0, 255, 157, 0.1);
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .contribution-cell:hover {
            transform: scale(1.3);
            border-color: var(--accent);
            z-index: 10;
        }

        .contribution-cell.active-1 {
            background: rgba(0, 255, 157, 0.3);
            border-color: rgba(0, 255, 157, 0.5);
            box-shadow: 0 0 5px rgba(0, 255, 157, 0.3);
        }

        .contribution-cell.active-2 {
            background: rgba(0, 255, 157, 0.5);
            border-color: rgba(0, 255, 157, 0.7);
            box-shadow: 0 0 8px rgba(0, 255, 157, 0.4);
        }

        .contribution-cell.active-3 {
            background: rgba(0, 255, 157, 0.7);
            border-color: rgba(0, 255, 157, 0.9);
            box-shadow: 0 0 12px rgba(0, 255, 157, 0.5);
        }

        .contribution-cell.active-4 {
            background: var(--accent);
            border-color: var(--accent-light);
            box-shadow: 0 0 15px rgba(0, 255, 157, 0.7);
        }

        .legend {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-top: 2rem;
            justify-content: center;
            flex-wrap: wrap;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
        }

        .intensity-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        .intensity-btn {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .intensity-btn:hover {
            transform: scale(1.1);
            border-color: var(--accent);
        }

        .intensity-btn.selected {
            border-color: var(--accent);
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
        }

        .patterns-section {
            margin-top: 2rem;
        }

        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 0.8rem;
        }

        .pattern-btn {
            background: rgba(0, 255, 157, 0.1);
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 0.7rem 1rem;
        }

        .leaderboard {
            margin-top: 2rem;
            background: rgba(0, 255, 157, 0.05);
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .leaderboard-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s;
        }

        .leaderboard-item:hover {
            border-color: var(--accent);
            transform: translateX(5px);
        }

        .leaderboard-rank {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            min-width: 40px;
        }

        .leaderboard-username {
            flex: 1;
            font-weight: 700;
        }

        .leaderboard-score {
            color: var(--accent);
            font-weight: 700;
        }

        footer {
            margin-top: 3rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            padding: 2rem 0;
            border-top: 1px solid var(--border-color);
        }

        .footer-ascii {
            font-family: 'Courier New', monospace;
            font-size: 0.4rem;
            color: var(--accent);
            line-height: 0.5rem;
            margin-top: 1rem;
            white-space: pre;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .contribution-cell { width: 10px; height: 10px; }
            .stat { padding: 1rem; }
            .stat-value { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-container">
            <div class="login-ascii">
    â•"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•'   ðŸ'¥ðŸ'¥ðŸ'¥ðŸ'¥ðŸ'¥ðŸ'¥ðŸ'¥   â•'
    â•'   MULTIPLAYER MODE    â•'
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            </div>
            <h2 class="login-title">Welcome Player!</h2>
            <p class="login-subtitle">Enter your username to join the contribution arena</p>
            <input type="text" id="usernameInput" class="login-input" placeholder="Enter username..." maxlength="20" />
            <button class="login-btn" onclick="login()">
                <i class="fas fa-gamepad"></i> START GAME
            </button>
        </div>
    </div>

    <!-- iOS Notification -->
    <div class="ios-notification" id="iosNotification">
        <div class="notification-header">
            <div class="notification-icon">
                <i class="fas fa-trophy"></i>
            </div>
            <div class="notification-app">CONTRIBUTION PRO</div>
            <div class="notification-time">now</div>
        </div>
        <div class="notification-title" id="notificationTitle"></div>
        <div class="notification-message" id="notificationMessage"></div>
    </div>

    <div class="container" id="mainContainer">
        <header>
            <div class="title-ascii">
â•"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•'   VAN_DRAGON CODEX :: MULTIPLAYER EDITION v4.0         â•'
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            </div>
            <h1>ðŸ‰ CONTRIBUTION MATRIX PRO</h1>
            <p class="subtitle">&gt;&gt; Real-Time Multiplayer :: Global Leaderboard</p>
            
            <div class="user-info">
                <div class="user-avatar" id="userAvatar"></div>
                <div>
                    <div style="font-weight: 700; color: var(--accent);" id="displayUsername"></div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Active Player</div>
                </div>
                <button class="btn btn-secondary" onclick="logout()" style="margin-left: auto;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>

            <div class="theme-switch">
                <button class="theme-btn active" id="default-theme" onclick="switchTheme('default')">
                    <i class="fas fa-circle" style="color: #00ff9d;"></i> Van_Dragon
                </button>
                <button class="theme-btn" id="dragonfire-theme" onclick="switchTheme('dragonfire')">
                    <i class="fas fa-fire" style="color: #ff3366;"></i> Dragonfire
                </button>
                <button class="theme-btn" id="cybervoid-theme" onclick="switchTheme('cybervoid')">
                    <i class="fas fa-water" style="color: #00b4d8;"></i> Cybervoid
                </button>
            </div>
        </header>

        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value" id="totalContributions">0</div>
                <div class="stat-label"><i class="fas fa-code-branch"></i> Contributions</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="currentStreak">0</div>
                <div class="stat-label"><i class="fas fa-fire"></i> Streak</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="longestStreak">0</div>
                <div class="stat-label"><i class="fas fa-trophy"></i> Best</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="totalChanges">0</div>
                <div class="stat-label"><i class="fas fa-history"></i> Changes</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="achievementCount">0<span style="font-size: 1.2rem;">/10</span></div>
                <div class="stat-label"><i class="fas fa-medal"></i> Achievements</div>
            </div>
        </div>

        <div class="game-section">
            <h2 class="section-header"><i class="fas fa-gamepad"></i> CONTROLS</h2>
            
            <div class="mode-indicator" id="modeIndicator">
                <i class="fas fa-mouse-pointer"></i>
                <span id="modeText">Click Mode</span>
            </div>

            <div class="intensity-selector">
                <span style="color: var(--text-secondary); font-size: 0.9rem;">Draw Intensity:</span>
                <div class="intensity-btn" data-level="0" style="background: rgba(255, 255, 255, 0.03);"></div>
                <div class="intensity-btn" data-level="1" style="background: rgba(0, 255, 157, 0.3);"></div>
                <div class="intensity-btn selected" data-level="2" style="background: rgba(0, 255, 157, 0.5);"></div>
                <div class="intensity-btn" data-level="3" style="background: rgba(0, 255, 157, 0.7);"></div>
                <div class="intensity-btn" data-level="4" style="background: var(--accent);"></div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="game.toggleDrawMode()" id="drawModeBtn">
                    <i class="fas fa-pencil-alt"></i> DRAW MODE
                </button>
                <button class="btn btn-secondary" onclick="game.undo()" id="undoBtn" disabled>
                    <i class="fas fa-undo"></i> UNDO
                </button>
                <button class="btn btn-secondary" onclick="game.redo()" id="redoBtn" disabled>
                    <i class="fas fa-redo"></i> REDO
                </button>
                <button class="btn btn-secondary" onclick="game.exportImage()">
                    <i class="fas fa-download"></i> EXPORT
                </button>
                <button class="btn" onclick="game.clear()">
                    <i class="fas fa-trash"></i> CLEAR
                </button>
                <button class="btn btn-secondary" onclick="game.randomize()">
                    <i class="fas fa-random"></i> RANDOM
                </button>
                <button class="btn btn-secondary" onclick="game.fillAll()">
                    <i class="fas fa-fill"></i> FILL
                </button>
                <button class="btn btn-secondary" onclick="game.savePattern()">
                    <i class="fas fa-save"></i> SAVE
                </button>
                <button class="btn btn-secondary" onclick="game.loadPattern()">
                    <i class="fas fa-folder-open"></i> LOAD
                </button>
            </div>

            <div class="grid-container">
                <div class="contribution-grid" id="contributionGrid"></div>
            </div>

            <div class="legend">
                <span style="color: var(--text-secondary); font-size: 0.85rem;">INTENSITY:</span>
                <div style="display: flex; gap: 8px;">
                    <div style="display: flex; align-items: center; gap: 4px;">
                        <div style="width: 14px; height: 14px; background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border-color); border-radius: 2px;"></div>
                        <span style="font-size: 0.8rem; color: var(--text-secondary);">0</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 4px;">
                        <div class="contribution-cell active-1"></div>
                        <span style="font-size: 0.8rem; color: var(--text-secondary);">1</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 4px;">
                        <div class="contribution-cell active-2"></div>
                        <span style="font-size: 0.8rem; color: var(--text-secondary);">2</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 4px;">
                        <div class="contribution-cell active-3"></div>
                        <span style="font-size: 0.8rem; color: var(--text-secondary);">3</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 4px;">
                        <div class="contribution-cell active-4"></div>
                        <span style="font-size: 0.8rem; color: var(--text-secondary);">4</span>
                    </div>
                </div>
            </div>

            <div class="patterns-section">
                <h3 style="font-family: 'Orbitron', sans-serif; color: var(--accent); margin-bottom: 1rem;">
                    <i class="fas fa-shapes"></i> PATTERN LIBRARY
                </h3>
                <div class="pattern-grid">
                    <button class="btn pattern-btn" onclick="game.createCheckerboard()">
                        <i class="fas fa-th"></i> Checkerboard
                    </button>
                    <button class="btn pattern-btn" onclick="game.createWave()">
                        <i class="fas fa-wave-square"></i> Wave
                    </button>
                    <button class="btn pattern-btn" onclick="game.createDiagonal()">
                        <i class="fas fa-slash"></i> Diagonal
                    </button>
                    <button class="btn pattern-btn" onclick="game.createHeart()">
                        <i class="fas fa-heart"></i> Heart
                    </button>
                    <button class="btn pattern-btn" onclick="game.createSmile()">
                        <i class="fas fa-smile"></i> Smile
                    </button>
                    <button class="btn pattern-btn" onclick="game.createGradient()">
                        <i class="fas fa-fill-drip"></i> Gradient
                    </button>
                    <button class="btn pattern-btn" onclick="game.createCircle()">
                        <i class="fas fa-circle"></i> Circle
                    </button>
                    <button class="btn pattern-btn" onclick="game.createBorder()">
                        <i class="fas fa-square"></i> Border
                    </button>
                    <button class="btn pattern-btn" onclick="game.createSpiral()">
                        <i class="fas fa-spinner"></i> Spiral
                    </button>
                    <button class="btn pattern-btn" onclick="game.createCross()">
                        <i class="fas fa-plus"></i> Cross
                    </button>
                </div>
            </div>

            <div class="leaderboard">
                <h3 style="font-family: 'Orbitron', sans-serif; color: var(--accent); margin-bottom: 1rem;">
                    <i class="fas fa-crown"></i> GLOBAL LEADERBOARD
                </h3>
                <div class="leaderboard-list" id="leaderboardList">
                    <!-- Dynamically populated -->
                </div>
            </div>
        </div>

        <footer>
            <p>Â© 2024 Van_Dragon Codex PRO â€¢ Multiplayer Edition</p>
            <p style="margin-top: 0.5rem;">
                <a href="https://github.com/Enyanwuma" target="_blank" style="color: var(--accent); text-decoration: none;">
                    <i class="fab fa-github"></i> @Enyanwuma
                </a>
            </p>
            <div class="footer-ascii">
â•"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•'  ðŸ'¥ POWERED BY THE COMMUNITY ðŸ'¥  â•'
â•'     â­â­â­â­â­ Thank You! â­â­â­â­â­     â•'
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            </div>
        </footer>
    </div>

    <script>
        let currentUsername = '';

        // Login function
        function login() {
            const username = document.getElementById('usernameInput').value.trim();
            if (username.length < 2) {
                showIOSNotification('Error', 'Username must be at least 2 characters');
                return;
            }
            
            currentUsername = username;
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('mainContainer').classList.add('active');
            document.getElementById('displayUsername').textContent = username;
            document.getElementById('userAvatar').textContent = username.charAt(0).toUpperCase();
            
            createDragonSeeds();
            window.game = new ContributionGame(username);
            
            showIOSNotification('Welcome!', `Let's create something amazing, ${username}!`);
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout? Your progress will be saved.')) {
                location.reload();
            }
        }

        // Theme switching
        function switchTheme(theme) {
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            document.body.classList.remove('theme-dragonfire', 'theme-cybervoid');
            
            if (theme === 'dragonfire') {
                document.getElementById('dragonfire-theme').classList.add('active');
                document.body.classList.add('theme-dragonfire');
            } else if (theme === 'cybervoid') {
                document.getElementById('cybervoid-theme').classList.add('active');
                document.body.classList.add('theme-cybervoid');
            } else {
                document.getElementById('default-theme').classList.add('active');
            }
            
            if (window.game) {
                window.game.trackThemeSwitch();
            }
        }

        // iOS Notification
        function showIOSNotification(title, message) {
            const notification = document.getElementById('iosNotification');
            document.getElementById('notificationTitle').textContent = title;
            document.getElementById('notificationMessage').textContent = message;
            
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Dragon Seeds Animation
        function createDragonSeeds() {
            for (let i = 0; i < 15; i++) {
                const seed = document.createElement('div');
                seed.className = 'dragon-seed';
                seed.style.left = `${Math.random() * 100}%`;
                seed.style.top = `${Math.random() * 100}%`;
                seed.style.animationDelay = `${Math.random() * 3}s`;
                seed.style.animationDuration = `${3 + Math.random() * 2}s`;
                document.body.appendChild(seed);
            }
        }

        // Intensity Selector
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.intensity-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.intensity-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    if (window.game) {
                        game.selectedIntensity = parseInt(this.dataset.level);
                    }
                });
            });

            // Enter key for login
            document.getElementById('usernameInput')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') login();
            });
        });

        // Contribution Game Class with Storage
        class ContributionGame {
            constructor(username) {
                this.username = username;
                this.weeks = 52;
                this.daysPerWeek = 7;
                this.grid = [];
                this.history = [];
                this.historyIndex = -1;
                this.drawMode = false;
                this.isDrawing = false;
                this.selectedIntensity = 2;
                this.totalChanges = 0;
                this.themeSwitches = 0;
                this.patternsUsed = new Set();
                this.achievements = this.initAchievements();
                this.stats = { total: 0, currentStreak: 0, longestStreak: 0 };
                
                this.init();
                this.loadUserData();
                this.setupKeyboardControls();
                this.updateLeaderboard();
            }

            initAchievements() {
                return [
                    { id: 'first_click', name: 'First Steps', desc: 'Make your first contribution', icon: 'fa-star' },
                    { id: 'century', name: 'Centurion', desc: 'Reach 100 contributions', icon: 'fa-fire' },
                    { id: 'full_week', name: 'Full Week', desc: 'Fill an entire week', icon: 'fa-calendar-check' },
                    { id: 'artist', name: 'Artist', desc: 'Use all 10 patterns', icon: 'fa-palette' },
                    { id: 'perfectionist', name: 'Perfectionist', desc: 'Fill all 364 squares', icon: 'fa-trophy' },
                    { id: 'time_traveler', name: 'Time Traveler', desc: 'Use undo 10 times', icon: 'fa-history' },
                    { id: 'streak_master', name: 'Streak Master', desc: 'Achieve a 50+ streak', icon: 'fa-bolt' },
                    { id: 'theme_switcher', name: 'Style Icon', desc: 'Try all 3 themes', icon: 'fa-adjust' },
                    { id: 'save_master', name: 'Archivist', desc: 'Save and load a pattern', icon: 'fa-save' },
                    { id: 'dedicated', name: 'Dedicated', desc: 'Make 500 total changes', icon: 'fa-medal' }
                ];
            }

            async loadUserData() {
                try {
                    const userData = await window.storage.get(`user:${this.username}`);
                    if (userData) {
                        const data = JSON.parse(userData.value);
                        this.totalChanges = data.totalChanges || 0;
                        this.themeSwitches = data.themeSwitches || 0;
                        this.patternsUsed = new Set(data.patternsUsed || []);
                        this.achievements = data.achievements || this.achievements;
                        
                        if (data.pattern) {
                            this.restoreGridState(data.pattern);
                            this.saveHistory();
                        }
                        
                        document.getElementById('totalChanges').textContent = this.totalChanges;
                        this.updateAchievementDisplay();
                    }
                } catch (error) {
                    console.log('No previous data found, starting fresh');
                }
            }

            async saveUserData() {
                const data = {
                    username: this.username,
                    pattern: this.getGridState(),
                    totalChanges: this.totalChanges,
                    themeSwitches: this.themeSwitches,
                    patternsUsed: Array.from(this.patternsUsed),
                    achievements: this.achievements,
                    stats: this.stats,
                    lastUpdated: Date.now()
                };
                
                try {
                    await window.storage.set(`user:${this.username}`, JSON.stringify(data));
                    await this.updateGlobalLeaderboard();
                } catch (error) {
                    console.error('Save failed:', error);
                }
            }

            async updateGlobalLeaderboard() {
                try {
                    await window.storage.set(
                        `leaderboard:${this.username}`,
                        JSON.stringify({
                            username: this.username,
                            score: this.stats.total,
                            streak: this.stats.longestStreak,
                            achievements: this.achievements.filter(a => a.unlocked).length,
                            timestamp: Date.now()
                        }),
                        true
                    );
                    this.updateLeaderboard();
                } catch (error) {
                    console.error('Leaderboard update failed:', error);
                }
            }

            async updateLeaderboard() {
                try {
                    const keys = await window.storage.list('leaderboard:', true);
                    if (!keys || !keys.keys) return;
                    
                    const players = [];
                    for (const key of keys.keys) {
                        try {
                            const data = await window.storage.get(key, true);
                            if (data) {
                                players.push(JSON.parse(data.value));
                            }
                        } catch (e) {
                            console.log('Skip invalid entry');
                        }
                    }
                    
                    players.sort((a, b) => b.score - a.score);
                    const top10 = players.slice(0, 10);
                    
                    const list = document.getElementById('leaderboardList');
                    list.innerHTML = top10.map((p, i) => `
                        <div class="leaderboard-item" style="${p.username === this.username ? 'border-color: var(--accent); background: rgba(0, 255, 157, 0.1);' : ''}">
                            <div class="leaderboard-rank">#${i + 1}</div>
                            <div class="leaderboard-username">
                                ${p.username}
                                ${p.username === this.username ? '<i class="fas fa-star" style="color: var(--accent);"></i>' : ''}
                            </div>
                            <div class="leaderboard-score">
                                ${p.score} <i class="fas fa-trophy" style="font-size: 0.8rem;"></i>
                            </div>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Leaderboard load failed:', error);
                }
            }

            init() {
                const gridElement = document.getElementById('contributionGrid');
                gridElement.innerHTML = '';

                for (let week = 0; week < this.weeks; week++) {
                    this.grid[week] = [];
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        const cell = document.createElement('div');
                        cell.className = 'contribution-cell';
                        cell.dataset.week = week;
                        cell.dataset.day = day;
                        cell.dataset.level = 0;
                        
                        cell.addEventListener('click', (e) => this.handleCellClick(e.target));
                        cell.addEventListener('mouseenter', (e) => {
                            if (this.drawMode && this.isDrawing) {
                                this.paintCell(e.target);
                            }
                        });
                        cell.addEventListener('mousedown', (e) => {
                            if (this.drawMode) {
                                this.isDrawing = true;
                                this.paintCell(e.target);
                            }
                        });
                        
                        gridElement.appendChild(cell);
                        this.grid[week][day] = cell;
                    }
                }

                document.addEventListener('mouseup', () => {
                    this.isDrawing = false;
                });
            }

            handleCellClick(cell) {
                if (!this.drawMode) {
                    this.toggleCell(cell);
                }
            }

            paintCell(cell) {
                const currentLevel = parseInt(cell.dataset.level);
                if (currentLevel !== this.selectedIntensity) {
                    this.saveHistory();
                    cell.dataset.level = this.selectedIntensity;
                    cell.className = 'contribution-cell';
                    if (this.selectedIntensity > 0) {
                        cell.classList.add(`active-${this.selectedIntensity}`);
                    }
                    this.updateStats();
                    this.saveUserData();
                }
            }

            toggleCell(cell) {
                this.saveHistory();
                const currentLevel = parseInt(cell.dataset.level);
                const newLevel = (currentLevel + 1) % 5;
                
                cell.dataset.level = newLevel;
                cell.className = 'contribution-cell';
                
                if (newLevel > 0) {
                    cell.classList.add(`active-${newLevel}`);
                }
                
                this.updateStats();
                this.saveUserData();
                this.checkAchievements();
            }

            saveHistory() {
                this.history = this.history.slice(0, this.historyIndex + 1);
                const state = this.getGridState();
                this.history.push(state);
                this.historyIndex++;
                
                if (this.history.length > 50) {
                    this.history.shift();
                    this.historyIndex--;
                }
                
                this.totalChanges++;
                document.getElementById('totalChanges').textContent = this.totalChanges;
                this.updateUndoRedoButtons();
            }

            getGridState() {
                const state = [];
                for (let week = 0; week < this.weeks; week++) {
                    state[week] = [];
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        state[week][day] = parseInt(this.grid[week][day].dataset.level);
                    }
                }
                return state;
            }

            restoreGridState(state) {
                for (let week = 0; week < this.weeks; week++) {
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        const level = state[week][day];
                        this.grid[week][day].dataset.level = level;
                        this.grid[week][day].className = 'contribution-cell';
                        if (level > 0) {
                            this.grid[week][day].classList.add(`active-${level}`);
                        }
                    }
                }
                this.updateStats();
            }

            undo() {
                if (this.historyIndex > 0) {
                    this.historyIndex--;
                    this.restoreGridState(this.history[this.historyIndex]);
                    this.updateUndoRedoButtons();
                    this.saveUserData();
                }
            }

            redo() {
                if (this.historyIndex < this.history.length - 1) {
                    this.historyIndex++;
                    this.restoreGridState(this.history[this.historyIndex]);
                    this.updateUndoRedoButtons();
                    this.saveUserData();
                }
            }

            updateUndoRedoButtons() {
                document.getElementById('undoBtn').disabled = this.historyIndex <= 0;
                document.getElementById('redoBtn').disabled = this.historyIndex >= this.history.length - 1;
            }

            toggleDrawMode() {
                this.drawMode = !this.drawMode;
                const indicator = document.getElementById('modeIndicator');
                const modeText = document.getElementById('modeText');
                const btn = document.getElementById('drawModeBtn');
                
                if (this.drawMode) {
                    indicator.classList.add('draw-active');
                    modeText.innerHTML = '<i class="fas fa-pencil-alt"></i> Draw Mode Active';
                    btn.innerHTML = '<i class="fas fa-times"></i> EXIT DRAW';
                    btn.style.background = 'rgba(255, 85, 85, 0.3)';
                } else {
                    indicator.classList.remove('draw-active');
                    modeText.innerHTML = '<i class="fas fa-mouse-pointer"></i> Click Mode';
                    btn.innerHTML = '<i class="fas fa-pencil-alt"></i> DRAW MODE';
                    btn.style.background = '';
                }
            }

            exportImage() {
                const grid = document.getElementById('contributionGrid');
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                const cellSize = 16;
                const gap = 4;
                canvas.width = this.weeks * (cellSize + gap);
                canvas.height = this.daysPerWeek * (cellSize + gap);
                
                ctx.fillStyle = '#0c0c1d';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                for (let week = 0; week < this.weeks; week++) {
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        const level = parseInt(this.grid[week][day].dataset.level);
                        const x = week * (cellSize + gap);
                        const y = day * (cellSize + gap);
                        
                        if (level === 0) ctx.fillStyle = 'rgba(255, 255, 255, 0.03)';
                        else if (level === 1) ctx.fillStyle = 'rgba(0, 255, 157, 0.3)';
                        else if (level === 2) ctx.fillStyle = 'rgba(0, 255, 157, 0.5)';
                        else if (level === 3) ctx.fillStyle = 'rgba(0, 255, 157, 0.7)';
                        else ctx.fillStyle = '#00ff9d';
                        
                        ctx.fillRect(x, y, cellSize, cellSize);
                        ctx.strokeStyle = 'rgba(0, 255, 157, 0.2)';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(x, y, cellSize, cellSize);
                    }
                }
                
                canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${this.username}-contribution-${Date.now()}.png`;
                    a.click();
                    URL.revokeObjectURL(url);
                    showIOSNotification('Export Complete', 'Your contribution matrix has been downloaded!');
                });
            }

            updateStats() {
                let total = 0;
                let currentStreak = 0;
                let longestStreak = 0;
                let tempStreak = 0;

                for (let week = 0; week < this.weeks; week++) {
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        const level = parseInt(this.grid[week][day].dataset.level);
                        if (level > 0) {
                            total++;
                            tempStreak++;
                            if (tempStreak > longestStreak) longestStreak = tempStreak;
                        } else {
                            tempStreak = 0;
                        }
                    }
                }

                currentStreak = tempStreak;
                document.getElementById('totalContributions').textContent = total;
                document.getElementById('currentStreak').textContent = currentStreak;
                document.getElementById('longestStreak').textContent = longestStreak;

                this.stats = { total, currentStreak, longestStreak };
                this.checkAchievements();
            }

            clear() {
                this.saveHistory();
                for (let week = 0; week < this.weeks; week++) {
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        this.grid[week][day].dataset.level = 0;
                        this.grid[week][day].className = 'contribution-cell';
                    }
                }
                this.updateStats();
                this.saveUserData();
            }

            randomize() {
                this.saveHistory();
                for (let week = 0; week < this.weeks; week++) {
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        const level = Math.floor(Math.random() * 5);
                        this.grid[week][day].dataset.level = level;
                        this.grid[week][day].className = 'contribution-cell';
                        if (level > 0) {
                            this.grid[week][day].classList.add(`active-${level}`);
                        }
                    }
                }
                this.updateStats();
                this.saveUserData();
            }

            fillAll() {
                this.saveHistory();
                for (let week = 0; week < this.weeks; week++) {
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        this.grid[week][day].dataset.level = 4;
                        this.grid[week][day].className = 'contribution-cell active-4';
                    }
                }
                this.updateStats();
                this.saveUserData();
            }

            trackPattern(name) {
                this.patternsUsed.add(name);
                if (this.patternsUsed.size >= 10) {
                    this.unlockAchievement('artist');
                }
            }

            trackThemeSwitch() {
                this.themeSwitches++;
                if (this.themeSwitches >= 3) {
                    this.unlockAchievement('theme_switcher');
                }
                this.saveUserData();
            }

            createCheckerboard() {
                this.saveHistory();
                this.trackPattern('checkerboard');
                for (let week = 0; week < this.weeks; week++) {
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        const level = (week + day) % 2 === 0 ? 4 : 0;
                        this.grid[week][day].dataset.level = level;
                        this.grid[week][day].className = 'contribution-cell';
                        if (level > 0) this.grid[week][day].classList.add(`active-${level}`);
                    }
                }
                this.updateStats();
                this.saveUserData();
            }

            createWave() {
                this.saveHistory();
                this.trackPattern('wave');
                for (let week = 0; week < this.weeks; week++) {
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        const level = Math.floor(Math.abs(Math.sin(week * 0.3) * Math.cos(day * 0.8)) * 4) + 1;
                        this.grid[week][day].dataset.level = level;
                        this.grid[week][day].className = 'contribution-cell';
                        if (level > 0) this.grid[week][day].classList.add(`active-${level}`);
                    }
                }
                this.updateStats();
                this.saveUserData();
            }

            createDiagonal() {
                this.clear();
                this.trackPattern('diagonal');
                this.saveHistory();
                for (let week = 0; week < this.weeks; week++) {
                    const day = (week * 2) % this.daysPerWeek;
                    if (day < this.daysPerWeek) {
                        this.grid[week][day].dataset.level = 4;
                        this.grid[week][day].className = 'contribution-cell active-4';
                    }
                }
                this.updateStats();
                this.saveUserData();
            }

            createHeart() {
                this.clear();
                this.trackPattern('heart');
                this.saveHistory();
                const heartPattern = [
                    [0,1,1,0,1,1,0],
                    [1,1,1,1,1,1,1],
                    [1,1,1,1,1,1,1],
                    [0,1,1,1,1,1,0],
                    [0,0,1,1,1,0,0],
                    [0,0,0,1,0,0,0]
                ];
                
                const startWeek = Math.floor(this.weeks / 2) - 3;
                for (let i = 0; i < heartPattern.length && startWeek + i < this.weeks; i++) {
                    for (let j = 0; j < heartPattern[i].length; j++) {
                        if (heartPattern[i][j] === 1) {
                            this.grid[startWeek + i][j].dataset.level = 4;
                            this.grid[startWeek + i][j].className = 'contribution-cell active-4';
                        }
                    }
                }
                this.updateStats();
                this.saveUserData();
            }

            createSmile() {
                this.clear();
                this.trackPattern('smile');
                this.saveHistory();
                const smilePattern = [
                    [0,1,1,1,1,1,0],
                    [1,0,0,0,0,0,1],
                    [0,1,0,0,0,1,0],
                    [0,0,0,0,0,0,0],
                    [0,1,0,0,0,1,0],
                    [0,0,1,1,1,0,0]
                ];
                
                const startWeek = Math.floor(this.weeks / 2) - 3;
                for (let i = 0; i < smilePattern.length && startWeek + i < this.weeks; i++) {
                    for (let j = 0; j < smilePattern[i].length; j++) {
                        if (smilePattern[i][j] === 1) {
                            this.grid[startWeek + i][j].dataset.level = 3;
                            this.grid[startWeek + i][j].className = 'contribution-cell active-3';
                        }
                    }
                }
                this.updateStats();
                this.saveUserData();
            }

            createGradient() {
                this.saveHistory();
                this.trackPattern('gradient');
                for (let week = 0; week < this.weeks; week++) {
                    const level = Math.floor((week / this.weeks) * 4) + 1;
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        this.grid[week][day].dataset.level = level;
                        this.grid[week][day].className = 'contribution-cell';
                        this.grid[week][day].classList.add(`active-${level}`);
                    }
                }
                this.updateStats();
                this.saveUserData();
            }

            createCircle() {
                this.clear();
                this.trackPattern('circle');
                this.saveHistory();
                const centerWeek = Math.floor(this.weeks / 2);
                const centerDay = Math.floor(this.daysPerWeek / 2);
                const radius = 10;
                
                for (let week = 0; week < this.weeks; week++) {
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        const distance = Math.sqrt(Math.pow(week - centerWeek, 2) + Math.pow(day - centerDay, 2));
                        if (distance <= radius) {
                            const level = Math.floor(4 - (distance / radius) * 3) + 1;
                            this.grid[week][day].dataset.level = level;
                            this.grid[week][day].className = 'contribution-cell';
                            this.grid[week][day].classList.add(`active-${level}`);
                        }
                    }
                }
                this.updateStats();
                this.saveUserData();
            }

            createBorder() {
                this.clear();
                this.trackPattern('border');
                this.saveHistory();
                for (let week = 0; week < this.weeks; week++) {
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        if (week === 0 || week === this.weeks - 1 || day === 0 || day === this.daysPerWeek - 1) {
                            this.grid[week][day].dataset.level = 4;
                            this.grid[week][day].className = 'contribution-cell active-4';
                        }
                    }
                }
                this.updateStats();
                this.saveUserData();
            }

            createSpiral() {
                this.clear();
                this.trackPattern('spiral');
                this.saveHistory();
                let week = 0, day = 0;
                let direction = 0;
                const visited = Array(this.weeks).fill().map(() => Array(this.daysPerWeek).fill(false));
                let level = 1;
                
                for (let i = 0; i < this.weeks * this.daysPerWeek; i++) {
                    this.grid[week][day].dataset.level = level;
                    this.grid[week][day].className = 'contribution-cell';
                    this.grid[week][day].classList.add(`active-${level}`);
                    visited[week][day] = true;
                    
                    level = (level % 4) + 1;
                    
                    let nextWeek = week;
                    let nextDay = day;
                    
                    if (direction === 0) nextWeek++;
                    else if (direction === 1) nextDay++;
                    else if (direction === 2) nextWeek--;
                    else nextDay--;
                    
                    if (nextWeek < 0 || nextWeek >= this.weeks || 
                        nextDay < 0 || nextDay >= this.daysPerWeek || 
                        visited[nextWeek]?.[nextDay]) {
                        direction = (direction + 1) % 4;
                        if (direction === 0) week++;
                        else if (direction === 1) day++;
                        else if (direction === 2) week--;
                        else day--;
                    } else {
                        week = nextWeek;
                        day = nextDay;
                    }
                }
                this.updateStats();
                this.saveUserData();
            }

            createCross() {
                this.clear();
                this.trackPattern('cross');
                this.saveHistory();
                const centerWeek = Math.floor(this.weeks / 2);
                const centerDay = Math.floor(this.daysPerWeek / 2);
                
                for (let week = 0; week < this.weeks; week++) {
                    this.grid[week][centerDay].dataset.level = 4;
                    this.grid[week][centerDay].className = 'contribution-cell active-4';
                }
                
                for (let day = 0; day < this.daysPerWeek; day++) {
                    this.grid[centerWeek][day].dataset.level = 4;
                    this.grid[centerWeek][day].className = 'contribution-cell active-4';
                }
                
                this.updateStats();
                this.saveUserData();
            }

            savePattern() {
                const pattern = this.getGridState();
                this.savedPattern = pattern;
                this.saveUserData();
                showIOSNotification('Pattern Saved', 'Your creation has been saved successfully!');
                this.unlockAchievement('save_master');
            }

            loadPattern() {
                if (this.savedPattern) {
                    this.saveHistory();
                    this.restoreGridState(this.savedPattern);
                    this.saveUserData();
                    showIOSNotification('Pattern Loaded', 'Your saved pattern has been restored!');
                    this.unlockAchievement('save_master');
                } else {
                    showIOSNotification('No Pattern Found', 'Save a pattern first before loading');
                }
            }

            setupKeyboardControls() {
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        if (e.key === 'z') {
                            e.preventDefault();
                            this.undo();
                        } else if (e.key === 'y') {
                            e.preventDefault();
                            this.redo();
                        }
                        return;
                    }
                    
                    switch(e.key.toLowerCase()) {
                        case 'c': this.clear(); break;
                        case 'r': this.randomize(); break;
                        case 'f': this.fillAll(); break;
                        case 'd': this.toggleDrawMode(); break;
                        case 's': e.preventDefault(); this.savePattern(); break;
                        case 'l': this.loadPattern(); break;
                    }
                });
            }

            checkAchievements() {
                if (this.stats.total > 0) this.unlockAchievement('first_click');
                if (this.stats.total >= 100) this.unlockAchievement('century');
                if (this.stats.total >= 364) this.unlockAchievement('perfectionist');
                if (this.stats.longestStreak >= 50) this.unlockAchievement('streak_master');
                if (this.historyIndex >= 10) this.unlockAchievement('time_traveler');
                if (this.totalChanges >= 500) this.unlockAchievement('dedicated');
                
                for (let week = 0; week < this.weeks; week++) {
                    let fullWeek = true;
                    for (let day = 0; day < this.daysPerWeek; day++) {
                        if (parseInt(this.grid[week][day].dataset.level) === 0) {
                            fullWeek = false;
                            break;
                        }
                    }
                    if (fullWeek) {
                        this.unlockAchievement('full_week');
                        break;
                    }
                }
            }

            unlockAchievement(id) {
                const achievement = this.achievements.find(a => a.id === id);
                if (achievement && !achievement.unlocked) {
                    achievement.unlocked = true;
                    this.updateAchievementDisplay();
                    showIOSNotification('ðŸ† Achievement Unlocked!', achievement.name);
                    this.saveUserData();
                }
            }

            updateAchievementDisplay() {
                const unlockedCount = this.achievements.filter(a => a.unlocked).length;
                document.getElementById('achievementCount').innerHTML = 
                    `${unlockedCount}<span style="font-size: 1.2rem;">/${this.achievements.length}</span>`;
            }
        }
    </script>
</body>
</html>
